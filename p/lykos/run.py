import os
import json
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

# --- Configuration ---
# List of numeric IDs to process
numbers = [
    3,
    4,
    5,
    6,
    7,
    8,
    9,
    21,
    24,
    25,
    27,
    30,
    34,
    35,
    36,
    42,
    46,
    54,
    56,
    62,
    73,
    79,
    83,
    92,
    96,
    97,
    101,
    103,
    104,
    105,
    108,
    110,
    112,
    113,
    114,
    115,
    117,
    119,
    121,
    122,
    124,
    125,
    129,
    130,
    132,
    136,
    137,
    140,
    141,
    145,
    146,
    151,
    152,
    153,
    154,
    155,
    156,
    158,
    159,
    160,
    162,
    163,
    164,
    165,
    166,
    169,
    170,
    171,
    174,
    178,
    179,
    181,
    183,
    184,
    185,
    192,
    194,
    195,
    198,
    199,
    200,
    201,
    202,
    203,
    208,
    210,
    211,
    214,
    215,
    216,
    220,
    221,
    223,
    224,
    226,
    227,
    228,
    229,
    230,
    235,
    236,
    238,
    239,
    241,
    242,
    248,
    250,
    252,
    253,
    257,
    258,
    259,
    260,
    261,
    262,
    263,
    264,
    265,
    266,
    267,
    269,
    270,
    271,
    272,
    274,
    276,
    277,
    278,
    279,
    282,
    284,
    288,
    290,
    291,
    292,
    293,
    294,
    295,
    296,
    298,
    299,
    300,
    301,
    302,
    303,
    305,
    307,
    310,
    313,
    315,
    316,
    323,
    324,
    325,
    326,
    328,
    329,
    330,
    331,
    333,
    334,
    337,
    338,
    339,
    342,
    343,
    344,
    345,
    346,
    347,
    348,
    350,
    351,
    352,
    354,
    355,
    356,
    359,
    361,
    362,
    363,
    366,
    367,
    369,
    372,
    373,
    374,
    375,
    377,
    378,
    379,
    381,
    382,
    385,
    386,
    388,
    389,
    390,
    393,
    397,
    398,
    399,
    400,
    401,
    402,
    403,
    404,
    406,
    407,
    408,
    425,
    426,
    427,
    428,
    429,
    432,
    433,
    443,
    444,
    446,
    447,
    449,
    451,
    452,
    453,
    454,
    455,
    456,
    458,
    459,
    460,
    462,
    464,
    465,
    466,
    467,
    468,
    469,
    470,
    471,
    472,
    473,
    477,
    478,
    482,
    483,
    484,
    488,
    489,
    490,
    491,
    493,
    495,
    496,
    500,
    502,
    505,
    506,
    507,
    512,
    515,
    519,
    522,
    523,
    524,
    526,
    529,
    530,
    531,
    535,
    538,
    541,
    542,
    543,
    548,
    549,
    553,
    559,
    562,
    564,
    567,
    568,
    569,
    570,
    571,
    572,
    573,
    575,
    578,
    580,
    581,
    583,
    584,
    586,
    588,
    590,
    591,
    592,
    593,
    595,
    596,
    597,
    599,
    600,
    602,
    603,
    604,
    607,
    609,
    610,
    612,
    613,
    614,
    615,
    616,
    617,
    618,
    621,
    622,
    624,
    626,
    627,
    628,
    630,
    633,
    634,
    636,
    638,
    643,
    647,
    648,
    649,
    650,
    651,
    653,
    655,
    656,
    658,
    660,
    667,
    669,
    670,
    672,
    673,
    674,
    676,
    677,
    678,
    679,
    680,
    681,
    683,
    684,
    687,
    688,
    689,
    691,
    692,
    693,
    695,
    698,
    702,
    704,
    705,
    706,
    711,
    713,
    716,
    717,
    718,
    719,
    720,
    721,
    722,
    723,
    724,
    725,
    726,
    730,
    734,
    735,
    746,
    748,
    751,
    752,
    753,
    755,
    756,
    758,
    760,
    762,
    764,
    766,
    773,
    774,
    777,
    780,
    782,
    784,
    785,
    786,
    788,
    789,
    791,
    792,
    801,
    802,
    803,
    804,
    805,
    808,
    817,
    819,
    822,
    823,
    824,
    826,
    830,
    831,
    833,
    836,
    843,
    844,
    848,
    849,
    852,
    859,
    862,
    864,
    866,
    867,
    868,
    871,
    872,
    874,
    875,
    877,
    878,
    879,
    880,
    881,
    882,
    884,
    889,
    890,
    891,
    895,
    897,
    901,
    902,
    909,
    912,
    913,
    920,
    923,
    925,
    935,
    940,
    943,
    944,
    945,
    947,
    951,
    952,
    953,
    956,
    958,
    959,
    960,
    961,
    963,
    968,
    971,
    974,
    975,
    980,
    982,
    990,
    992,
    994,
    999,
    1002,
    1004,
    1008,
    1009,
    1011,
    1012,
    1015,
    1016,
    1018,
    1019,
    1021,
    1028,
    1029,
    1032,
    1034,
    1036,
    1037,
    1038,
    1039,
    1042,
    1044,
    1047,
    1048,
    1049,
    1052,
    1053,
    1054,
    1058,
    1059,
    1060,
    1061,
    1062,
    1063,
    1064,
    1066,
    1068,
    1071,
    1073,
    1075,
    1076,
    1077,
    1088,
    1090,
    1095,
    1099,
    1104,
    1105,
    1109,
    1110,
    1112,
    1117,
    1121,
    1123,
    1126,
    1129,
    1130,
    1135,
    1139,
    1143,
    1152,
    1155,
    1160,
    1161,
    1165,
    1166,
    1170,
    1176,
    1177,
    1178,
    1179,
    1186,
    1192,
    1193,
    1194,
    1197,
    1199,
    1201,
    1205,
    1206,
    1207,
    1209,
    1210,
    1211,
    1225,
    1232,
    1233,
    1235,
    1238,
    1240,
    1241,
    1243,
    1250,
    1253,
    1255,
    1256,
    1262,
    1268,
    1271,
    1274,
    1275,
    1277,
    1279,
    1280,
    1283,
    1284,
    1285,
    1287,
    1293,
    1299,
    1302,
    1303,
    1305,
    1306,
    1315,
    1317,
    1319,
    1320,
    1322,
    1324,
    1333,
    1335,
    1336,
    1337,
    1347,
    1348,
    1349,
    1351,
    1353,
    1356,
    1357,
    1358,
    1359,
    1363,
    1368,
    1370,
    1372,
    1375,
    1376,
    1377,
    1379,
    1382,
    1385,
    1386,
    1387,
    1391,
    1393,
    1397,
    1398,
    1403,
    1405,
    1415,
    1417,
    1422,
    1429,
    1431,
    1432,
    1437,
    1438,
    1439,
    1440,
    1444,
    1445,
    1447,
    1448,
    1452,
    1456,
    1458,
    1459,
    1460,
    1462,
    1463,
    1466,
    1467,
    1470,
    1471,
    1475,
    1481,
    1485,
    1487,
    1499,
    1500,
    1501,
    1506,
    1509,
    1511,
    1514,
    1516,
    1520,
    1538,
    1542,
    1548,
    1559,
    1565,
    1571,
    1573,
    1580,
    1588,
    1590,
    1601,
    1611,
    1616,
    1629,
    1633,
    1641,
    1642,
    1643,
    1647,
    1652,
    1665,
    1671,
    1674,
    1682,
    1684,
    1685,
    1687,
    1692,
    1695,
    1704,
    1705,
    1709,
    1719,
    1721,
    1727,
    1730,
    1734,
    1735,
    1740,
    1745,
    1750,
    1753,
    1755,
    1759,
    1762,
    1764,
    1765,
    1766,
    1767,
    1773,
    1802,
    1804,
    1809,
    1810,
    1825,
    1837,
    1847,
    1850,
    1851,
    1855,
    1856,
    1869,
    1870,
    1882,
    1884,
    1901,
    1905,
    1912,
    1913,
    1918,
    1921,
    1925,
    1928,
    1929,
    1930,
    1932,
    1933,
    1935,
    1941,
    1945,
    1948,
    1954,
    1955,
    1959,
    1960,
    1963,
    1965,
    1967,
    1972,
    1977,
    1978,
    1979,
    1984,
    1985,
    1986,
    1989,
    1996,
    2001,
    2014,
    2017,
    2019,
    2022,
    2024,
    2035,
    2044,
    2052,
    2058,
    2065,
    2072,
    2078,
    2087,
    2088,
    2094,
    2096,
    2102,
    2108,
    2111,
    2112,
    2113,
    2115,
    2134,
    2153,
    2157,
    2165,
    2166,
    2168,
    2175,
    2176,
    2177,
    2181,
    2182,
    2185,
    2187,
    2189,
    2198,
    2200,
    2205,
    2207,
    2208,
    2217,
    2219,
    2224,
    2228,
    2229,
    2238,
    2243,
    2246,
    2249,
    2261,
    2273,
    2280,
    2292,
    2298,
    2320,
    2322,
    2324,
    2328,
    2355,
    2356,
    2358,
    2366,
    2372,
    2373,
    2388,
    2390,
    2398,
    2400,
    2415,
    2416,
    2421,
    2422,
    2424,
    2426,
    2428,
    2434,
    2437,
    2438,
    2442,
    2446,
    2447,
    2454,
    2461,
    2463,
    2470,
    2488,
    2490,
    2492,
    2493,
    2494,
    2496,
    2506,
    2518,
    2522,
    2523,
    2526,
    2528,
    2547,
    2549,
    2550,
    2554,
    2561,
    2568,
    2570,
    2580,
    2582,
    2590,
    2594,
    2595,
    2606,
    2609,
    2610,
    2615,
    2616,
    2633,
    2634,
    2636,
    2641,
    2643,
    2653,
    2655,
    2657,
    2662,
    2664,
    2667,
    2671,
    2676,
    2677,
    2680,
    2681,
    2684,
    2686,
    2687,
    2688,
    2691,
    2694,
    2695,
    2696,
    2697,
    2704,
    2708,
    2709,
    2718,
    2719,
    2726,
    2730,
    2734,
    2735,
    2736,
    2740,
    2744,
    2745,
    2746,
    2751,
    2753,
    2758,
    2761,
    2765,
    2766,
    2772,
    2773,
    2776,
    2778,
    2779,
    2781,
    2785,
    2792,
    2794,
    2800,
    2803,
    2814,
    2818,
    2823,
    2830,
    2838,
    2839,
    2847,
    2848,
    2865,
    2870,
    2871,
    2876,
    2886,
    2891,
    2892,
    2897,
    2898,
    2899,
    2905,
    2918,
    2919,
    2923,
    2929,
    2932,
    2933,
    2934,
    2938,
    2940,
    2941,
    2943,
    2944,
    2947,
    2950,
    2954,
    2960,
    2961,
    2962,
    2967,
    2968,
    2972,
    2973,
    2974,
    2979,
    2980,
    2981,
    2989,
    2992,
    2996,
    2999,
    3005,
    3007,
    3013,
    3020,
    3022,
    3032,
    3034,
    3036,
    3038,
    3039,
    3042,
    3044,
    3048,
    3049,
    3052,
    3060,
    3065,
    3066,
    3069,
    3070,
    3077,
    3079,
    3082,
    3083,
    3086,
    3090,
    3095,
    3102,
    3103,
    3105,
    3106,
    3107,
    3114,
    3116,
    3117,
    3121,
    3124,
    3130,
    3131,
    3132,
    3133,
    3134,
    3136,
    3139,
    3141,
    3142,
    3143,
    3147,
    3149,
    3150,
    3151,
    3160,
    3162,
    3164,
    3166,
    3170,
    3172,
    3173,
    3178,
    3179,
    3180,
    3183,
    3184,
    3193,
    3195,
    3196,
    3198,
    3199,
    3204,
    3205,
    3207,
    3209,
    3210,
    3214,
    3215,
    3216,
    3219,
    3220,
    3222,
    3223,
    3224,
    3225,
    3229,
    3230,
    3231,
    3236,
    3237,
    3243,
    3245,
    3247,
    3251,
    3252,
    3257,
    3258,
    3259,
    3261,
    3262,
    3264,
    3265,
    3268,
    3271,
    3274,
    3275,
    3276,
    3279,
    3283,
    3288,
    3289,
    3290,
    3293,
    3294,
    3296,
    3297,
    3299,
    3305,
    3308,
    3309,
    3310,
    3311,
    3317,
    3319,
    3323,
    3329,
    3333,
    3334,
    3335,
    3336,
    3343,
    3346,
    3354,
    3356,
    3359,
    3360,
    3363,
    3369,
    3370,
    3371,
    3373,
    3374,
    3377,
    3378,
    3379,
    3387,
    3388,
    3390,
    3391,
    3392,
    3396,
    3397,
    3400,
    3403,
    3406,
    3408,
    3411,
    3413,
    3415,
    3416,
    3418,
    3420,
    3423,
    3425,
    3426,
    3428,
    3430,
    3432,
    3433,
    3434,
    3435,
    3437,
    3444,
    3445,
    3446,
    3448,
    3449,
    3451,
    3452,
    3454,
    3455,
    3456,
    3459,
    3460,
    3461,
    3463,
    3464,
    3466,
    3467,
    3482,
    3483,
    3486,
    3487,
    3488,
    3490,
    3491,
    3499,
    3503,
    3504,
    3506,
    3507,
    3509,
    3511,
    3513,
    3514,
    3515,
    3517,
    3518,
    3519,
    3522,
    3523,
    3526,
    3527,
    3530,
    3531,
    3532,
    3533,
    3535,
    3536,
    3538,
    3540,
    3542,
    3543,
    3547,
    3551,
    3554,
    3567,
    3568,
    3569,
    3570,
    3572,
    3579,
    3580,
    3582,
    3585,
    3586,
    3591,
    3597,
    3598,
    3605,
    3606,
    3607,
    3609,
    3613,
    3614,
    3616,
    3621,
    3624,
    3626,
    3627,
    3629,
    3638,
    3641,
    3642,
    3643,
    3648,
    3651,
    3653,
    3654,
    3658,
    3660,
    3662,
    3665,
    3667,
    3670,
    3671,
    3673,
    3674,
    3680,
    3684,
    3688,
    3692,
    3693,
    3695,
    3696,
    3698,
    3699,
    3700,
    3701,
    3702,
    3703,
    3706,
    3709,
    3711,
    3712,
    3713,
    3714,
    3715,
    3716,
    3721,
    3722,
    3723,
    3725,
    3727,
    3728,
    3729,
    3730,
    3738,
    3744,
    3747,
    3750,
    3751,
    3752,
    3756,
    3757,
    3758,
    3759,
    3763,
    3765,
    3767,
    3769,
    3770,
    3771,
    3778,
    3780,
    3782,
    3783,
    3784,
    3787,
    3793,
    3795,
    3798,
    3800,
    3802,
    3803,
    3804,
    3805,
    3809,
    3811,
    3814,
    3816,
    3818,
    3819,
    3822,
    3826,
    3830,
    3846,
    3849,
    3850,
    3851,
    3853,
    3854,
    3856,
    3859,
    3862,
    3863,
    3865,
    3866,
    3869,
    3870,
    3872,
    3876,
    3877,
    3879,
    3882,
    3886,
    3887,
    3903,
    3912,
    3914,
    3915,
    3938,
    3939,
    3944,
    3965,
    3969,
    3972,
    3986,
    4012,
    4022,
    4028,
    4031,
    4040,
    4053,
    4065,
    4080,
    4083,
    4105,
    4115,
    4120,
    4123,
    4135,
    4146,
    4156,
    4164,
    4176,
    4177,
    4178,
    4182,
    4183,
    4186,
    4203,
    4212,
    4227,
    4230,
    4240,
    4248,
    4251,
    4259,
    4272,
    4273,
    4274,
    4279,
    4286,
    4292,
    4297,
    4304,
    4320,
    4322,
    4331,
    4338,
    4341,
    4346,
    4356,
    4357,
    4394,
    4395,
    4397,
    4403,
    4415,
    4434,
    4459,
    4464,
    4467,
    4485,
    4486,
    4489,
    4501,
    4511,
    4513,
    4516,
    4522,
    4523,
    4535,
    4538,
    4540,
    4544,
    4569,
    4578,
    4580,
    4590,
    4592,
    4598,
    4599,
    4625,
    4629,
    4637,
    4654,
    4661,
    4665,
    4673,
    4692,
    4694,
    4698,
    4702,
    4753,
    4765,
    4766,
    4773,
    4776,
    4789,
    4810,
    4833,
    4850,
    4863,
    4867,
    4869,
    4870,
    4884,
    4887,
    4890,
    4897,
    4899,
    4921,
    4923,
    4936,
    4958,
    4980,
    4984,
    5001,
    5004,
    5011,
    5024,
    5035,
    5039,
    5046,
    5054,
    5066,
    5076,
    5079,
    5095,
    5098,
    5108,
    5146,
    5155,
    5178,
    5205,
    5207,
    5216,
    5217,
    5220,
    5224,
    5232,
    5234,
    5235,
    5238,
    5252,
    5262,
    5266,
    5270,
    5288,
    5297,
    5308,
    5328,
    5330,
    5361,
    5365,
    5375,
    5377,
    5384,
    5385,
    5400,
    5401,
    5402,
    5414,
    5418,
    5423,
    5433,
    5451,
    5468,
    5469,
    5472,
    5481,
    5492,
    5527,
    5534,
    5536,
    5544,
    5557,
    5581,
    5592,
    5596,
    5602,
    5612,
    5620,
    5621,
    5634,
    5637,
    5638,
    5640,
    5651,
    5653,
    5658,
    5665,
    5667,
    5676,
    5683,
    5690,
    5691,
    5692,
    5695,
    5699,
    5701,
    5713,
    5721,
    5779,
    5801,
    5813,
    5823,
    5829,
    5835,
    5837,
    5839,
    5873,
    5883,
    5893,
    5901,
    5905,
    5915,
    5927,
    5967,
    5985,
    6005,
    6045,
    6049,
    6103,
    6139,
    6183,
    6191,
    6221,
    6225,
    6263,
    6267,
    6283,
    6305,
    6331,
    6365,
    6387,
    6393,
    6417,
    6419,
    6439,
    6461,
    6463,
    6465,
    6471,
    6485,
    6491,
    6493,
    6499,
    6507,
    6519,
    6561,
    6575,
    6587,
    6613,
    6623,
    6655,
    6677,
    6687,
    6697,
    6713,
    6715,
    6717,
    6719,
    6721,
    6787,
    6789,
    6807,
    6829,
    6839,
    6849,
    6875,
    6885,
    6901,
    6907,
    6909,
    6939,
    6945,
    6949,
    6965,
    6995,
    7001,
    7013,
    7019,
    7055,
    7065,
    7075,
    7077,
    7117,
    7119,
    7181,
    7189,
    7301,
    7353,
    7419,
    7461,
    7851,
    7875,
    7905,
    7927,
    7931,
    7939,
    7959,
    8003,
    8017,
    8027,
    8029,
    8097,
    8129,
    8149,
    8199,
    8225,
    8233,
    8283,
    8339,
    8387,
    8421,
    8423,
    8425,
    8447,
    8453,
    8469,
    8559,
    8605,
    8625,
    8629,
    8631,
    8651,
    8657,
    8683,
    8777,
    8799,
    8833,
    8865,
    9017,
    9027,
    9039,
    9065,
    9113,
    9131,
    9245,
    9363,
    9381,
    9439,
    9027,
    9039,
    9065,
    9113,
    9131,
    9245,
    9363,
    9381,
    9439,
]

# Path to the JSON database
DB_PATH = "db.json"
# URL template
URL_TEMPLATE = "https://istart.rajasthan.gov.in/profile/{}/startups"
# CSS selectors for fields
SELECTORS = {
    "name": ".about-card_title",
    "website": ".about-card_desig",
    "description": ".about-card_text",
    "industry": ".experience-box:nth-of-type(1) .experience-box_text",
    "stage": ".experience-box:nth-of-type(2) .experience-box_text",
    "qrate": ".experience-box:nth-of-type(3) .experience-box_text",
    "id": ".experience-box:nth-of-type(4) .experience-box_text",
}


# --- Helper Functions ---
def load_db(path):
    if not os.path.exists(path):
        with open(path, "w") as f:
            json.dump([], f)
    with open(path, "r") as f:
        return json.load(f)


def save_db(path, data):
    with open(path, "w") as f:
        json.dump(data, f, indent=4)


def filter_new_numbers(existing, nums):
    seen = {int(item.get("numericId")) for item in existing}
    return [n for n in nums if n not in seen]


# --- Main Scraper ---


def main():
    # Load or initialize database
    db = load_db(DB_PATH)
    # Filter out already-processed IDs
    to_process = filter_new_numbers(db, numbers)
    if not to_process:
        print("All numbers already processed. Exiting.")
        return

    # Initialize Selenium WebDriver (Chrome)
    driver = webdriver.Chrome()
    wait = WebDriverWait(driver, 15)

    for num in to_process:
        url = URL_TEMPLATE.format(num)
        print(f"Processing {url}")
        driver.get(url)

        # Wait until the page loads
        wait.until(EC.presence_of_element_located((By.CSS_SELECTOR, SELECTORS["name"])))

        # Scrape fields
        record = {}
        for field, sel in SELECTORS.items():
            try:
                elem = driver.find_element(By.CSS_SELECTOR, sel)
                text = elem.text.strip()
            except Exception:
                text = None

            # Convert qrate to int if possible
            if field == "qrate" and text:
                try:
                    text = int(text)
                except ValueError:
                    text = None

            record[field] = text

        # Add numericId
        record["numericId"] = num

        # Append to database and save
        db.append(record)
        save_db(DB_PATH, db)
        print(f"Saved data for ID {num}")

    driver.quit()


if __name__ == "__main__":
    main()
